# React の始め方（Vite 編）
本プロジェクト `with-vite` は、React の基本的な概要と動作を理解するためのサブプロジェクト。
このファイルがある階層で、以下の手順を実施していくことで、サンプルコードと同様の成果物が作れる。

`with-vite` は、主に **ツール利用による環境構築の容易さ** を説明する。

## 前提
- 本リポジトリ内のサブプロジェクト `basic` 内容を理解した人を対象としている
- 同様に React の環境構築を容易にする「Create React App」を利用した方法との違いに通いても言及することがある
- インターネット接続可能/最新の安定版(LTS版)のバージョンで Node.js がインストール済みの環境であること
- 閲覧時期によっては、バージョン更新や情報の最新化により、本内容が陳腐化する可能性がある

## 全体の流れ
- 事前準備
- Vite を利用したプロジェクトの作成
- 内部構成の概要説明

## 事前準備
まず、アプリケーションのプロジェクトを作成する任意の場所を選んでおく。そして、そこに移動しておくこと

## Vite の導入とアプリのテンプレート作成
React の動作環境を簡単に用意できるツール Vite を導入する。それと同時に、アプリケーションの雛形の作成も同時に完了させる。

尚、過去に人気の React 入門キットであった「Create React App（CRA）」と違い、Vite は React の入門キットとしてのツールではない。
あくまでその一部として、React の環境構築を容易にする機能が提供されており、今回はそれを利用する。

以下のコマンドで、任意のアプリ名でプロジェクトを作成
```bash
npm create vite@latest demo-app -- --template react
```

初めて実行する場合、以下のように質問されることがある。その場合は、そのまま Enter キーを押せば処理が進む
```bash
# 必要なものをインストールしていいかを訊かれる
Need to install the following packages:
create-vite@5.5.5
Ok to proceed? (y) # Enter キーで "Yes" 回答となり、自動生成がスタートする

# 内部的に npx でコマンドを実行している
> npx
> create-vite demo-app --template react


Scaffolding project in /{ローカルマシンのアプリが生成される場所}

# # ここまで表示されたら処理完了（次の手順が示される）
Done. Now run:

  cd demo-app
  npm install
  npm run dev
```

補足：`npx` コマンドは、`npm` と違い、実際に node モジュールをインストールせず、一時的に実行してプログラム自体はマシン内に残さない方法を取るコマンド（上記では、create-vite を一時的に実行するが、これ自体は依存関係としてインストールされていない）。`npm create` コマンドは、内部的に `npx` コマンドを実行する、Node.js が提供する機能の１つ。

成功すれば、プロジェクトのディレクトリごと、動作に必要なファイルがすべて生成される

生成されたプロジェクトディレクトリに移動する
```bash
cd demo-app
```

node_modules ディレクトリがまだ無いはずなので、依存関係があるモジュールをすべてインストールする
```bash
npm i
```

起動する
```bash
npm run dev
```

以下のような起動結果がコンソールに表示される
```bash
  VITE v5.4.11  ready in 487 ms

  ➜  Local:   http://localhost:5173/
  ➜  Network: use --host to expose
  ➜  press h + enter to show help
```

デフォルトでは、自動で Web ブラウザ画面は立ち上がらないので、指定された URL（今回なら `http://localhost:5173/`）をブラウザで表示する

自動でブラウザを立ち上げたい場合は、package.json の vite の起動コマンドに `--open` オプションをつける
```json
"scripts": {
  "dev": "vite --open", // --open を追加
  :
},
```

修正後、起動すると自動でブラウザも立ち上がる
```bash
npm run dev
```

## 内部構成をざっくりと把握する
まず、README.md には、生成されたアプリケーションに関する概要が記載されており、関連リンクやコマンドの簡単な説明等がされている

### package.json から内部構成を確認する
このファイルで注目すべきは、"dependencies" と "scripts"。
これを見れば、内部的に何が使われているのか、どんなコマンドが用意されているのかわかる。

- "dependencies"　および "devDependencies" の部分を確認すると、このアプリを開発する際にインストールされたモジュールが確認できる
  - react, react-dom: この２つは React として必ず必要なコアモジュール
  - vite: `basic` プロジェクトで説明した際に登場した、トランスパイラ（Babel）やモジュールバンドラー（Webpack）等の一連のツールを含んだパッケージ

- npm コマンドで実行できる "scripts" については以下の通り
  - `npm run dev`: トランスパイラとモジュールバンドラーを内部的に用いて、「ホットリロード」が効いた開発サーバが起動する、開発作業用のコマンド
    - ただし、webpack, webpack-dev-server は用いていない
  - `npm run build`: トランスパイルとバンドルを実行し、本番環境のサーバに格納するファイル群を出力する、本番用のコマンド
    - ただし、モジュールバンドラー として webpack は用いず、vite が独自に処理する
    - これを実行されると、`basic` の時の様に "dist" というディレクトリを出力する
  - `npm run lint`: ソースコードの構文チェックを実行し、記法に間違いなどがないかを確認する（今回、これ以上の説明は割愛する）
  - `npm run preview`: `npm run build` でビルドしたものを実際にローカル環境で確認するためのコマンド。チェック用であり、本番環境では使用できない（今回、これ以上の説明は割愛する）
    - これ自体は、ビルド処理を実行しない。ビルドされたものを利用する

### package-lock.json から、更に内部構成を把握する
package-lock.json とは、プロジェクトの構成を説明する package.json の中で、内部的に利用しているツールを更に細かく列挙するファイルである。

具体的には、package.json の "dependencies" および "devDependencies" で利用すると示されたツール群が、その更に内部で何の外部ツールを利用しているのかを把握できる。
通常の開発作業では、そこまで確認する必要はあまりない。

このファイルを確認すると、**vite** モジュールの中で、内部的に babel を利用していることがわかる。ただし、 webpack は利用しておらず、バンドルは独自処理で実行している。

### ソースコードの構成をざっくりと把握する
`basic` プロジェクトの時は、すべてのファイルが同一ディレクトリの直下に配置されて横並びになっていたが、本来はこのプロジェクトのように、役割・用途によってディレクトリを分けた方がわかりやすい。

- index.html: React コンポーネントが挿入される対象の HTML ファイルが、アプリケーションのプロジェクトディレクトリのすぐ下に配置される
  - `/src/main.jsx` の JSX ファイルを参照するようになっており、開発サーバー起動時には、Vite が要求に応じてリアルタイムに main.jsx をトランスパイルして提供してくれる
  - 本番用ビルド時、Vite はこの HTML ファイルを処理し、必要に応じて最適化してくれる
- public: `src/assets` と同様にアプリケーションで利用される静的なリソースファイルを配置する
  - `src/assets` はビルドの過程で処理される静的リソースファイルだが、public はビルド時に処理されず、そのままビルド後の dist ディレクトリにコピーされる点が異なる
  - ファビコンや robots.txt, 大きな画像ファイルなど処理が不要なアセットをこちらに格納する
- src: React として開発作業を行うファイルがここにまとまっている
  - assets: コンポーネント固有の画像や SVG ファイル、CSS ファイルやビルドの過程で最適化すべき静的リソースをこちらに格納する
  - main.jsx: ここで React のルートコンポーネント（最初の親コンポーネント）が作成され、これが index.html に挿入される。更に内部的に App コンポーネント（App.jsx）を呼び出して利用している
  - index.css: main.jsx に付随するグローバルな CSS ファイル
  - App.jsx: １つの Web ページの構成部品（＝コンポーネント）。これが、main.jsx に呼び出されて、画面に表示される
  - App.css: App.jsx に付随する個別の CSS ファイル

## まとめ
本プロジェクトでは、サブプロジェクト `basic` で紹介した React の環境を構成する要素が、ツールの利用によって容易になることを、Vite を利用して紹介した。

基本的には、React を単独で利用する場合は、このテンプレートから開発を始めていくのが１つの推奨された方法である。
